
- id: espresso_machine_warmed_up
  alias: Warmed up
  trigger:
    platform: state
    entity_id: binary_sensor.espresso_machine_is_hot
    from: "off"
    to: "on"
  action:
    service: notify.mobile_app_iphone_se_2nd_generation
    data:
      title: "Espresso machine"
      message: "Warmed up!"
      data:
        group: "esspresso-notification-group"
        tag: "esspresso-notification-tag"

- id: espresso_machine_stale
  alias: Start timers for espresso machine
  trigger:
    platform: state
    entity_id: switch.lumi_lumi_plug_mmeu01_on_off
    to: "on"
    for: "00:00:30"
  action:
  - service: timer.start
    target:
      entity_id: timer.espresso_machine_shutdown
  - service: notify.mobile_app_iphone_se_2nd_generation
    data:
      title: "Espresso machine"
      message: "Stale!"
      data:
        group: "esspresso-notification-group"
        tag: "esspresso-notification-tag"
        actions:
        - action: "EXTEND" # The key you are sending for the event
          title: "Extend for 10m" # The button title
          destructive: true
        - action: "SHUTDOWN"
          title: "Turn off"

- id: espresso_turn_off
  alias: Stop timers for espresso machine
  trigger:
    platform: state
    entity_id: switch.lumi_lumi_plug_mmeu01_on_off
    to: "off"
  action:
    service: timer.cancel
    target:
      entity_id: timer.espresso_machine_shutdown

- id: espresso_machine_shutdown
  alias: "Turn off espresso machine by timer"
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.espresso_machine_shutdown
  action:
    service: switch.turn_off
    entity_id: switch.lumi_lumi_plug_mmeu01_on_off
